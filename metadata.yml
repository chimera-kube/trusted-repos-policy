rules:
- apiGroups: [""]
  apiVersions: ["v1"]
  resources: ["pods"]
  operations: ["CREATE", "UPDATE"]
mutating: false
annotations:
  io.kubewarden.policy.title: trusted-repos-policy
  io.kubewarden.policy.description: Kubewarden policy that restricts what registries, tags and images can pods on your cluster refer to 
  io.kubewarden.policy.author: Rafael Fernández López
  io.kubewarden.policy.url: https://github.com/kubewarden/trusted-repos-policy
  io.kubewarden.policy.source: https://github.com/kubewarden/trusted-repos-policy
  io.kubewarden.policy.license: Apache-2.0
  io.kubewarden.policy.usage: |
    The policy configuration allows to mix and match several filters: registries, tags, and images.

    When both an allow list and a reject list is supported, only one can be provided at the same time for that specific filter.

    * Registries
      * Allow list
      * Reject list

    * Tags
      * Reject list

    * Images
      * Allow list
      * Reject list

    # Examples

    ## Only allow images coming from `registry.my-corp.com`

    ```yaml
    registries:
      allow:
      - registry.my-corp.com
    ```

    ## Only reject one host, in this case the Docker Hub

    ```yaml
    registries:
      reject:
      - docker.io
    ```

    ## Reject the latest tag for all images

    ```yaml
    tags:
      reject:
      - latest
    ```

    ## Only reject one specific image, allow the rest

    ```yaml
    images:
      reject:
      - quay.io/etcd/etcd:v3.4.12
    ```

    ## Only accept a well known set of images, reject the rest

    ```yaml
    images:
      accept:
      - quay.io/coreos/etcd:v3.4.12@sha256:7ed2739c96eb16de3d7169e2a0aa4ccf3a1f44af24f2bb6cad826935a51bcb3d
      - quay.io/bitnami/redis:6.0@sha256:82dfd9ac433eacb5f89e5bf2601659bbc78893c1a9e3e830c5ef4eb489fde079
    ```
